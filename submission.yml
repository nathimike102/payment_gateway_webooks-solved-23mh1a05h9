# Payment Gateway - Submission Configuration
# Complete implementation with Vercel deployment

submission:
  name: "Payment Gateway - Multi-Method Processing with Async Webhooks"
  version: "1.0.0"
  status: "Production Deployed"
  url: "https://payment-gateway-h9.vercel.app"

setup:
  local_development:
    - "Docker and Docker Compose required"
    - "Run: docker-compose up -d"
    - "Services start automatically: API, Dashboard, PostgreSQL, Redis, Worker"
  
  verify_setup:
    - "Health Check: curl http://localhost:3000/api/v1/health"
    - "Dashboard: http://localhost:3000"
    - "API: http://localhost:8000"

start:
  production:
    - url: "https://payment-gateway-h9.vercel.app"
    - credentials: "test@example.com / test123"
  
  local_docker:
    - command: "docker-compose up -d"
    - dashboard: "http://localhost:3000"
    - api: "http://localhost:8000"
    - services: "API, Dashboard (Nginx proxy), PostgreSQL, Redis, Worker"

test:
  health_check:
    - local: "curl http://localhost:3000/api/v1/health"
    - production: "curl https://payment-gateway-h9.vercel.app/api/v1/health"
  
  register_merchant:
    - curl -X POST http://localhost:3000/api/v1/auth/register \
      -H "Content-Type: application/json" \
      -d '{"name": "Test", "email": "test@example.com", "password": "pass123", "confirmPassword": "pass123"}'
  
  login:
    - url: "http://localhost:3000/login"
    - credentials: "test@example.com / test123"
  
  create_order:
    - curl -X POST http://localhost:3000/api/v1/orders \
      -H "X-Api-Key: your_api_key" \
      -H "X-Api-Secret: your_api_secret" \
      -H "Content-Type: application/json" \
      -d '{"amount": 50000, "currency": "INR", "receipt": "order_123"}'

debug:
  logs:
    - "API: docker logs -f gateway_api"
    - "Dashboard: docker logs -f gateway_dashboard"
    - "Worker: docker logs -f gateway_worker"
    - "PostgreSQL: docker logs pg_gateway"
  
  endpoints:
    - "Queue Status: curl http://localhost:3000/api/v1/queue/status"
    - "SDK Loading: curl http://localhost:3000/sdk/payment-gateway.js"
  
  cleanup:
    - "Stop: docker-compose down"
    - "Reset: docker-compose down -v"

features:
  - Multi-method payment processing (UPI, Card)
  - Async webhook delivery with HMAC signatures
  - Merchant onboarding and authentication
  - Order and payment management
  - Refund processing
  - Idempotency key support
  - Dashboard with real-time statistics
  - API key/secret authentication
  - PostgreSQL database
  - Redis job queue

deployment:
  production:
    platform: "Vercel"
    url: "https://payment-gateway-h9.vercel.app"
    database: "Neon PostgreSQL (ap-southeast-2)"
    cache: "Upstash Redis"
  
  local:
    platform: "Docker Compose"
    services:
      - Dashboard (Nginx): port 3000
      - API (Node.js): port 8000
      - PostgreSQL: port 5432
      - Redis: port 6379
      - Worker: background processor

troubleshooting:
  containers_not_starting:
    - "Check ports: lsof -i :3000 :8000 :5432 :6379"
    - "View logs: docker-compose logs"
    - "Rebuild: docker-compose build --no-cache"
  
  api_404_errors:
    - "Verify API: curl http://localhost:8000/api/v1/health"
    - "Rebuild: docker-compose build api --no-cache && docker-compose restart api"
  
  proxy_not_working:
    - "Check nginx config: docker exec gateway_dashboard cat /etc/nginx/conf.d/default.conf"
    - "Test proxy: docker exec gateway_dashboard curl http://api:8000/api/v1/health"
    - "Rebuild dashboard: docker-compose build dashboard --no-cache"

shutdown:
  commands:
    - "Stop all: docker-compose stop"
    - "Remove containers: docker-compose down"
    - "Remove volumes (reset data): docker-compose down -v"

services:
  api:
    port: 8000
    healthcheck: GET /health
    
  dashboard:
    port: 3000
    
  checkout:
    port: 3001
    
  redis:
    port: 6379
    
  worker:
    service: background job processor for async payment/webhook processing
